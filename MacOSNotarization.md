# macOS Application Notarization in a GitHub Action

This document outlines the steps and key components involved in notarizing a macOS application using a GitHub Action workflow.

## Steps

1.  **Checkout repository**: The first step is to checkout the code from the repository.
2.  **Set up Xcode**: Select the appropriate Xcode version to use for the build.
3.  **Create build directory**: A directory is created to store the build artifacts.
4.  **Import Developer ID Certificate**: The Developer ID certificate, stored as a secret, is decoded and imported into a temporary keychain. This keychain is then configured for use.
5.  **Configure keychain for codesign**: The keychain is configured to be accessible by the `codesign` tool.
6.  **Install Provisioning Profile**: The provisioning profile, also stored as a secret, is decoded and installed.
7.  **Build and Archive App**: The Xcode project is built and archived. This step includes enabling hardened runtime and specifying the code signing identity and provisioning profile.
8.  **Export App**: The archived app is exported using a predefined `ExportOptions.plist` file.
9.  **Notarize app**: The exported app is zipped and submitted to Apple's notary service. The workflow waits for the notarization to complete and then staples the notarization ticket to the app.
10. **Create DMG**: The notarized app is packaged into a DMG file for distribution.
11. **Upload DMG to Release**: The final DMG is uploaded to a GitHub Release.

## Key Components

### Certificates

A "Developer ID Application" certificate is used to sign your application for distribution outside of the Mac App Store. This certificate is exported as a `.p12` file and stored as a secret in GitHub Actions. It verifies that the app is from a known developer.

```bash
security export -t identities -f pkcs12 -k ~/Library/Keychains/login.keychain-db -o ~/Downloads/DeveloperID.p12
```

### Identifiers

Your Apple Developer Team ID is a unique 10-character string generated by Apple that identifies your team. It's used in the build process to associate your app with your developer account. You can find your Team ID on the [Apple Developer website](https://developer.apple.com/account/#/membership).

An Application ID (or Bundle ID) is a unique identifier for your application, typically in a reverse-DNS format (e.g., `com.yourcompany.yourapp`). This ID is crucial as it's embedded in your app and the provisioning profile, linking them together.

While you can register App IDs manually on the Apple Developer website, Xcode typically handles this for you when you create a new project. You can view and edit the Bundle ID in the "Signing & Capabilities" tab of your project's target settings.

### Profiles

A provisioning profile is a file that connects the developer's identity (via the certificate) and the application's identity (via the App ID). For "Developer ID" distribution, it also contains the entitlements that your application is permitted to use.

Here are the key components of the provisioning profile used in this workflow:

*   **App ID**: The identifier that specifies the application the profile is for.
*   **Certificates**: The "Developer ID Application" certificates that are authorized to sign the app.
*   **Entitlements**: These define the specific capabilities and services your app is allowed to use, such as iCloud, push notifications, or access to the App Sandbox.

### App-Specific Password

An app-specific password is a unique password that you can generate for services that don't support two-factor authentication. The `notarytool` used in the GitHub Action requires an app-specific password to authenticate with Apple's servers. You can create one by signing into your [Apple ID account page](https://appleid.apple.com), navigating to the "App-Specific Passwords" section, and generating a new password.

### Secrets Stored in the GitHub Action Workflow

The GitHub Actions workflow relies on several secrets to handle sensitive information:

*   `DEVELOPER_ID_P12`: The base64-encoded "Developer ID Application" certificate.
*   `DEVELOPER_ID_P12_PASSWORD`: The password for the `.p12` certificate file.
*   `MACOS_PROVISIONING_PROFILE`: The base64-encoded application provisioning profile.
*   `APPLE_TEAM_ID`: Your Apple Developer Team ID.
*   `APPLE_ID`: The Apple ID used for notarization.
*   `APP_SPECIFIC_PASSWORD`: An app-specific password for the Apple ID, required for `notarytool`.

